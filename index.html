<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Invaders</title>
<style>
  body { background: black; color: white; text-align: center; font-family: sans-serif; }
  canvas { background: #000; display: block; margin: 20px auto; }
</style>
</head>
<body>
<h1>Space Invaders</h1>
<p>Controls: ← → Move | Space to Shoot</p>
<canvas id="gameCanvas" width="400" height="400"></canvas>
<p>Score: <span id="score">0</span> | Stage: <span id="stage">1</span></p>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const playerStart = {x:180, y:360, width:40, height:20, speed:5};
let player = {...playerStart};
let bullets = [];
let enemies = [];
let score = 0;
let stage = 1; // stage counter
let rightPressed = false;
let leftPressed = false;
let enemySpeed = 0.5; // initial speed
const speedIncrement = 0.25; // speed increase per stage

function spawnEnemies() {
  enemies = [];
  for(let i=0;i<5;i++){
    for(let j=0;j<6;j++){
      if(Math.random() < 0.7){
        enemies.push({x: 40*j + 20, y: 40*i + 20, width:30, height:20, alive:true});
      }
    }
  }
}

spawnEnemies();

document.addEventListener("keydown", e=>{
  if(e.key==="ArrowRight") rightPressed=true;
  if(e.key==="ArrowLeft") leftPressed=true;
  if(e.key===" ") shoot();
});

document.addEventListener("keyup", e=>{
  if(e.key==="ArrowRight") rightPressed=false;
  if(e.key==="ArrowLeft") leftPressed=false;
});

function shoot(){
  bullets.push({x: player.x + player.width/2 - 2.5, y: player.y, width:5, height:10});
}

function drawPlayer(){
  ctx.fillStyle="#00D0FF"; // player color
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawBullets(){
  ctx.fillStyle="yellow";
  bullets.forEach((b,i)=>{
    ctx.fillRect(b.x,b.y,b.width,b.height);
    b.y -= 7;
    if(b.y < 0) bullets.splice(i,1);
  });
}

function drawEnemies(){
  ctx.fillStyle="red";
  enemies.forEach((e)=>{
    if(e.alive){
      ctx.fillRect(e.x,e.y,e.width,e.height);
      e.y += enemySpeed;
    }
  });
}

function checkCollision(){
  bullets.forEach((b,bi)=>{
    enemies.forEach((e)=>{
      if(e.alive && b.x < e.x + e.width && b.x + b.width > e.x &&
         b.y < e.y + e.height && b.y + b.height > e.y){
           e.alive=false;
           bullets.splice(bi,1);
           score += 10;
           document.getElementById('score').innerText = score;
      }
    });
  });
}

function resetGame(){
  // Reset player if enemies reach bottom
  player = {...playerStart};
  bullets = [];
  score = 0;
  document.getElementById('score').innerText = score;
  stage = 1;
  document.getElementById('stage').innerText = stage;
  enemySpeed = 0.5; // reset speed
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(rightPressed && player.x + player.width < canvas.width) player.x += player.speed;
  if(leftPressed && player.x > 0) player.x -= player.speed;

  drawPlayer();
  drawBullets();
  drawEnemies();
  checkCollision();

  // Reset player if enemies reach bottom
  if(enemies.some(e=>e.alive && e.y + e.height >= canvas.height)){
    resetGame();
    spawnEnemies();
  }

  // Spawn new enemies if all dead, increase speed, increment stage
  if(enemies.every(e=>!e.alive)){
    enemySpeed += speedIncrement; // speed up
    stage += 1; // next stage
    document.getElementById('stage').innerText = stage;
    spawnEnemies();
  }

  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>
